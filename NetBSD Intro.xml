<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V1.0//EN"
"http://www.oasis-open.org/docbook/xml/simple/1.0/sdocbook.dtd">
<article>
  <title>NetBSD 3.0 Installation Quick and Clean</title>

  <subtitle>This document is aimed at gathering the best way to properly
  install NetBSD 3.0 on your machine <emphasis>(ix86)</emphasis>, as quick as
  possible, with 3 sample configurations : Server, Desktop,
  Enhanced</subtitle>

  <section>
    <title>Prerequisites</title>

    <para>For the following, I assume that you have access to a broadband
    connection using your network, so you are able to download easily the
    needed files. This is nowadays likely to be the case with most of the
    modem-router broadband devices... It is also the simplest way to set it
    up.</para>

    <para>I also assume that you have a basic knowledge of computers, you know
    quite well how to use OS like windows, and maybe some other systems. If
    something is unclear for you can refer to the <ulink
    url="http://www.netbsd.org/guide/en/">NetBSD Guide</ulink> which explains
    all the details you might need.</para>

    <para>- Server machine will run at least an HTTP serv, an FTP server, with
    SSH remote access enable.</para>

    <para>- Desktop machine will run at least XFCE4 with openoffice2
    :-)</para>

    <para>- Enhanced machine will run at least XFCE4 with 3D HW Acceleration
    to be able to play nice games :-D</para>

    <para>- All of them will be able to be kept up-to-date easily using
    CVS...</para>

    <para></para>

    <para>In the future I plan to include all the details needed so even
    "BSD-dummies" can install NetBSD.</para>

    <para>If there is any problem or you are not sure of what to do, just read
    the appropriate section of the <ulink
    url="http://www.netbsd.org/guide/en/">NetBSD Guide.</ulink></para>

    <para>For any comments and feedback, I would like to hear from you, so
    send me a <ulink url="mailto:asmodehn@gna.org">mail</ulink> ;-)</para>

    <para></para>
  </section>

  <section>
    <title>New Installation</title>

    <para><emphasis>This document is now focusing on installing NetBSD 3.0 (
    will be updated to match the last stable release only, although it should
    be usable for most of them )</emphasis></para>

    <section>
      <title>Using Floppies</title>

      <para>NB : The iso image is more easy to install. so if it is your first
      time, go for the iso :-)</para>

      <para>However for those who dont have a CD writer, you can get the
      floppy images from one of the servers, and create floppies. See the
      NetBSD guide for details.</para>

      <para>Boot on floppy. During the install you might need to configure the
      network to get the install sets from the network.</para>
    </section>

    <section>
      <title>Using CDROM</title>

      <para>Get the iso image from one of the server, and burn it.</para>

      <para>Boot on CD.</para>
    </section>

    <section>
      <title>SysInst</title>

      <para>Sysint greatly helps you to install and preconfigure NetBSD. The
      message given are usually accurate, and people have worked a lot to make
      them as usefull as possible, so read them :-)</para>

      <para>First you have to choose the language for the install, then your
      keyboard layout.</para>

      <para>After that you have access to the main menu of Sysinst were you
      can choose what you want to do. Usually you will select "Install NetBSD"
      unless you are here for a specific purpose.</para>

      <para></para>

      <para>Now going for the installation, select "Full installation". (if
      you dont want to use X installed or some other specific requirements, go
      for the "Custom installation")</para>

      <para>The geometry detected for your disk should be fine. Then you have
      to decide if you want to use the entire disk on only one part of it (in
      the last case, you have to edit the MBR).</para>

      <para>Choose to update the MBR, unless you want to mess with
      bootloaders.</para>

      <para>Now with the NetBSD partitions, the default one is the most
      scalable, as you will not need to modify your partitions, therefore it
      is quite suitable for simple setups like Server and Desktop. But if you
      still plan to resize your partitions be aware that you should not put
      less space than the indicated default as it is the usual minimum space
      requirement. A good idea is also to balance the space between /usr and
      /home, depending of the number of user (/home bigger) and software
      installed (/usr bigger).</para>

      <para>But remember, there is no way that I am aware of to resize your
      partitions later, so, unless you really know what you are doing, you
      better keep the default setting, with only one big / partition.</para>

      <para>After that you can check your disklabel. Everything should be ok
      here. If something looks strange to you, check the NetBSD guide to
      understand what a disklabel is used for.</para>

      <para>Last chance to go cancel the install without harming your
      system...</para>

      <para>Now your disk is being initialized and all the selected sets are
      installed.</para>

      <para></para>

      <para>Now you have to set your locale time zone. If unsure, or if you
      dont want to bother about timezones (likely if you have windows on the
      same machine with automatic ntp updates), set it to
      <emphasis>Universal</emphasis>.</para>

      <para>For the passwords, if you dont have any other machine around on
      the network to deal with passwords, I would suggest to use blowfish
      algorithm, as it should be more secure...</para>

      <para>Also, defining the root password now will prevent you to forget it
      later on.</para>

      <para>And as a root shell I would personaly go for ksh, just because of
      the autocompletion by default.</para>

      <para></para>

      <section>
        <title>Server settings</title>

        <para>If you plan to have a server, and wants to modify the default
        partition setup, I would allocate more space on /var. I personaly
        advise for a /var of 2GB size at least if you dont want to bother to
        much after installation about it. Many things get written in there by
        default. (logs, mails, pkg database, temp uncompress, etc.)</para>
      </section>

      <section>
        <title>Desktop settings</title>

        <para>For a Desktop setup the default settings should be pretty fine
        :-)</para>

        <para>Although you might want to have your /home isolated from the
        rest of the system just in case of something going wrong on the
        disk...</para>
      </section>

      <section>
        <title>Enhanced settings</title>

        <para>You might want to add softdep on FFSv1 for /usr, and /home
        therefore the operation on heavy loaded file systems will be more
        efficient. You will be able to do that after the first boot just by
        editing your /etc/fstab file. However it is not safe enough to use it
        for /root and /var in my own opinion...</para>

        <para>As an example here is my setup on a 40GB disk on my laptop (1GB
        RAM) :</para>

        <para>4 GB / (more than enough)</para>

        <para>2 GB swap (usually around 2x the amount of RAM)</para>

        <para>10 GB /usr ( as 0.3 GB for the base + 83 MB for src and building
        the OS + 236 MB for pkgsrc and space to build big software like OOo 2
        + 125MB for xsrc and space to build it )</para>

        <para>2 GB /var (should be ok for quite a long time)</para>

        <para>20+ GB /home</para>

        <para>1 GB /tmp ( more than enough)</para>

        <para></para>
      </section>
    </section>
  </section>

  <section>
    <title>First Boot : Setup the OS</title>

    <para><emphasis>NB from 2.0 : there is no need to change the keyboard
    layout on the first boot anymore. Sysinst has already modified the
    /etc/wscons.conf file for you.</emphasis></para>

    <para></para>

    <section>
      <title>Checking the installed OS</title>

      <para>First verify that your setup for your partition is fine, always a
      good idea to see what your OS needs as disk space to run :</para>

      <para><literal>&gt; df</literal></para>

      <para>Check your corresponding /etc/fstab file (add softdep setting now
      if you want to).</para>

      <para><literal>&gt; vi /etc/fstab</literal></para>

      <para>Check what is running by default :</para>

      <para><literal>&gt; top</literal></para>

      <para>Check which internet socket are open :</para>

      <para><literal>&gt; netstat -f inet</literal></para>

      <para></para>
    </section>

    <section>
      <title>Basic setup of the installed OS</title>

      <para>First just read your /etc/rc.conf. It gather all you system
      configuration.</para>

      <para><literal>&gt; more /etc/rc.conf</literal></para>

      <para>Pretty empty ? then all the settings come from the default file
      :</para>

      <para><literal>&gt; more /etc/defaults/rc.conf</literal></para>

      <para>Now that you know what this is about, you can turn on or off the
      part of the system you want to use. For example I dont use sendmail, so
      I can remove it from /etc/rc.conf by editing it</para>

      <para><literal>&gt; vi /etc/rc.conf</literal></para>

      <para>and adding this line</para>

      <para><literal>sendmail=NO</literal></para>

      <para>but I might use postfix from time to time just for smtp, and also
      to get all the maintenance messages sent to root... So go to your
      <literal>/etc/mailer.conf</literal>, comment the sendmail lines, and
      uncomment the postfix lines. now back to your
      <literal>/etc/rc.conf</literal>, and add :</para>

      <para><literal>postfix=YES</literal></para>

      <para></para>

      <para>Now I advise you to create a new user, for you and your every-day
      work. Using the system always with a root account is a bad idea, as one
      little mistake can destroy everything...</para>

      <para>So first enable ksh by default for all the new created
      users</para>

      <para><literal>&gt; vi /etc/usermgmt.conf</literal></para>

      <para>change the related line to be :</para>

      <para><literal>shell /bin/ksh</literal></para>

      <para>Now you can add a new user with his own group, who will be able to
      su to root and define his password:</para>

      <para><literal>&gt; useradd -G wheel -g &lt;username&gt; -m
      &lt;username&gt;</literal></para>

      <para><literal>&gt; passwd &lt;username&gt;</literal></para>

      <para>Then exit and login again as the new user. If everything works
      fine, you can call "su" to authenticate as root again to continue to
      setup your OS.</para>

      <para></para>

      <para>Now you need to setup a hostname for your computer.</para>

      <para>The easiest way to do that is by creating the file /etc/myname,
      and put the hostname in.</para>

      <para><literal>echo "MyHostname" &gt; /etc/myname</literal></para>

      <para></para>

      <para>Then you need to setup your network card (also called
      "interface"). Once again edit your rc.conf :</para>

      <para><literal>&gt; vi /etc/rc.conf</literal></para>

      <para>If you are connected to a DHCP server, and want to use the network
      information it can provide :</para>

      <para><literal>dhclient=YES
      dhclient_flags=”&lt;interface&gt;”</literal></para>

      <para>&lt;interface&gt; means the network interface that appear in
      dmesg. For me “ne0”.</para>

      <para>Otherwise you can provide static network information by creating a
      specific file for ifconfig:</para>

      <para><literal>&gt; vi /etc/ifconfig.&lt;interface&gt;</literal></para>

      <para>and inside put the parameter you would put like using ifconfig on
      the command line :</para>

      <para><literal>inet 192.168.0.42 netmask 0xffffff00</literal></para>

      <para>You can test your network configuration anytime by calling
      :</para>

      <para><literal>&gt; ifconfig -a</literal></para>

      <para>Once you have activated the interface, you can go to another
      machine connected to the network and try to ping your new NetBSD
      computer.</para>

      <para>Now to access internet from your new NetBSD computer you need to
      define the gateway. For example :</para>

      <para><literal>&gt; echo "192.168.1.1" &gt; /etc/mygate</literal></para>

      <para>Then you have to define the dns server to resolv internet names.
      Edit /etc/resolv.conf :</para>

      <para><literal>&gt; vi /etc/resolv.conf</literal></para>

      <para>and add the DNS server(s) you want to use to resolve internet
      names.</para>

      <para><literal>name server 192.168.1.1</literal></para>

      <para></para>

      <para>You may also have some devices to read floppy, cd , dvd,
      etc.</para>

      <para>Let say that you have one floppy drive and one cdrom reader for
      example.</para>

      <para>To be able to use them now edit /etc/fstab to add entries for
      cdrom and floppy. Simply add those lines :</para>

      <para><literal>/dev/cd0 /mnt/cdrom cd9660 ro,noauto 0 0</literal></para>

      <para><literal>/dev/fd0 /mnt/floppy msdos rw,noauto 0 0</literal></para>

      <para></para>

      <para>Then you have to create those directories :</para>

      <para><literal>&gt; mkdir /mnt/cdrom /mnt/floppy</literal></para>

      <para></para>

      <para>Do the same for any device you may want to mount. "man fstab" is
      your friend :-). And remember putting all your mounted devices in /mnt
      will prevent a mess in your root directory (especially true if you have
      multiple HDD)</para>

      <para>Reboot and test that everything is running fine :-)</para>

      <para></para>
    </section>

    <section>
      <title>Advanced setup of the installed OS</title>

      <para>Now lets get a bit more fancy :-)</para>

      <para>For example, I like having 4 virtual terminal, but why not being
      able to use the max amount, that is 8 of them ?</para>

      <para>first you have to edit /etc/wscons.conf :</para>

      <para><literal>&gt; vi /etc/wscons.conf</literal></para>

      <para>and add the corresponding line at the right place :</para>

      <para><literal>screen5 - -</literal></para>

      <para><literal>screen6 - -</literal></para>

      <para><literal>screen7 - -</literal></para>

      <para><literal>screen8 - -</literal></para>

      <para>then to be able to log in those terminals, you have to edit
      /etc/ttys :</para>

      <para><literal>&gt; vi /etc/ttys</literal></para>

      <para>Usually I change console to <literal>off</literal>, and I keep
      ttyE0 to <literal>off</literal> not to mix console output and shell,
      then I add the needed lines :</para>

      <para><literal>ttyE4 "/usr/libexec/getty Pc" vt220 on
      secure</literal></para>

      <para><literal>ttyE5 "/usr/libexec/getty Pc" vt220 on
      secure</literal></para>

      <para><literal>ttyE6 "/usr/libexec/getty Pc" vt220 on
      secure</literal></para>

      <para><literal>ttyE7 "/usr/libexec/getty Pc" vt220 on
      secure</literal></para>

      <para>reboot and try them :-)</para>

      <para></para>

      <para>Do you want to setup X ? just run :</para>

      <para><literal>&gt; xf86cfg</literal></para>

      <para>It should detect your hardware, and setup a default configuration
      for you. After that you can customize your X setup.</para>

      <para>Then exit and save the configuration. Now test it :</para>

      <para><literal>&gt; startx</literal></para>

      <para>The server X will run with all the default settings. If you want
      to change those settings just create .xinitrc and .xsession file from
      /usr/X11R6/lib/X11/xinit/xinitrc, and modify them. Refer to X
      documentation for advanced questions.</para>

      <para>We will go a bit further later when we will have our desktop
      manager.</para>

      <para></para>

      <para>And now what if you want to be able to install software ? or
      customise your installation even more ? Then try this usefull script :
      sysupdate.</para>

      <para>Using this script you can quite easily download and update via CVS
      the source for the OS (/usr/src) for the X server (/usr/xsrc) or the
      pkgsrc tree (/usr/pkgsrc)</para>

      <para>Just look at the first lines, you will see where you can easily
      customize the variables to match your needs.</para>

      <para>For the next step, just checkout pkgsrc like that :</para>

      <para><literal>&gt; ./sysupdate pkgsrc</literal></para>

      <para></para>
    </section>
  </section>

  <section>
    <title>Second Boot : Installing Useful Software</title>

    <para>If you want to install a Server, you might need only the Common
    Console Software, and the Server Software.</para>

    <para>If you want to install a Desktop, you might need only the Common
    Console Software, Common Graphic Software and the Desktop Software.</para>

    <para>If you want to install a Development , you might need only the
    Common Console Software, Common Graphic Software, the Desktop Software and
    the Enhanced Software.</para>

    <section>
      <title>Install Common Console Software</title>

      <para></para>

      <para>There are the software i use on my computers, for a fully
      fonctionnal console station :</para>

      <orderedlist>
        <listitem>
          <para>devel/cpuflags : install it first to optimize building from
          sources for your cpu...</para>
        </listitem>

        <listitem>
          <para>shells/standalone-tcsh : and make it the default for all users
          ( more easy than ksh )</para>
        </listitem>

        <listitem>
          <para>editors/easyedit : you can also make it the default editor of
          a user by editing ~/.cshrc and ~/.profile</para>
        </listitem>

        <listitem>
          <para>editors/vim : much more advanced than vi. If you install gvim
          for to have a gtk GUI, don't install it, as the gvim package build
          also vim for console.</para>
        </listitem>

        <listitem>
          <para>mail/fetchmail : to fetch mail from an external mail
          server</para>
        </listitem>

        <listitem>
          <para>mail/mutt : to read mail</para>
        </listitem>

        <listitem>
          <para>chat/micq : to chat on icq. Run it once, it will create
          ~/.micq/micqrc file. Quit it and edit this file to add your ICQ
          password. Run it again, and after a well-done login, just type :
          "contact import"</para>
        </listitem>

        <listitem>
          <para>chat/bitchx : to chat on irc</para>
        </listitem>

        <listitem>
          <para>www/links : to surf the web ;-)</para>
        </listitem>

        <listitem>
          <para>net/lftp : an great unix ftp client</para>
        </listitem>

        <listitem>
          <para>sysutils/cdrecord : usefull if you have a CD / DVD writer
          (also contain mkisofs)</para>
        </listitem>
      </orderedlist>

      <para></para>

      <para>I actualy advise you to test them all in console, and take time to
      be used to work with your console, as it is always here, even if you
      don't have access directly to your computer, SSH POWER !!!</para>

      <para>This is really useful...</para>

      <para></para>

      <para>For specific use, you can also install :</para>

      <orderedlist>
        <listitem>
          <para>audio/lame : to encode audioYou need to accept the license and
          edit mk.conf, as it is said :</para>
        </listitem>
      </orderedlist>

      <para>ACCEPTABLE_LICENSES+=fee-based-commercial-license</para>

      <orderedlist>
        <para></para>

        <listitem>
          <para>audio/cdparanoia : to recover bad audio CDs on wav</para>
        </listitem>

        <listitem>
          <para>graphics/povray : to generate images by eralistic rendering
          from a .pov file, all in one command line ;-)You need to accept the
          license and edit mk.conf, as it is said :</para>
        </listitem>
      </orderedlist>

      <para>ACCEPTABLE_LICENSES+=povray-license</para>

      <para></para>

      <para></para>

      <orderedlist>
        <listitem>
          <para>graphics/ImageMagick : to edit and convert images in command
          line, really useful.</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Install Common Graphic Software</title>

      <para></para>

      <para>There are the software I use for a fully fonctionnal X station
      :</para>

      <orderedlist>
        <listitem>
          <para>mail/fetchmailconf (GUI for fetchmail)</para>
        </listitem>

        <listitem>
          <para>graphics/gimp</para>
        </listitem>

        <listitem>
          <para>graphics/blender (only if you can activate dri in X, otherwise
          it is really useless)</para>
        </listitem>

        <listitem>
          <para>devel/SDL</para>
        </listitem>

        <listitem>
          <para>editors/nedit</para>
        </listitem>

        <listitem>
          <para>devel/anjuta</para>
        </listitem>

        <listitem>
          <para>multimedia/mplayer</para>
        </listitem>

        <listitem>
          <para>www/mozilla</para>
        </listitem>

        <listitem>
          <para>aterm</para>
        </listitem>

        <listitem>
          <para>games/xpuyopuyo, games/xmahjong, games/frozen-bubble,
          games/freeciv-client (there is pubserver.freeciv.org where you can
          play without using your own server ;-). Nice isn't it ?)</para>
        </listitem>

        <listitem>
          <para>wm/fluxbox</para>
        </listitem>

        <listitem>
          <para>wm/xfce4-wm et wm/xfce4-wm-themes</para>
        </listitem>

        <listitem>
          <para>misc/openoffice. Beware ! You need huge disk space to build it
          from source. If you want to build it on external disk, just type
          "env WRKOBJSRC=/extern_mount/pkgsrc make update"</para>
        </listitem>
      </orderedlist>

      <para></para>

      <para></para>
    </section>

    <section>
      <title>Install Server Software</title>

      <para></para>

      <para>There are the software I am using on most of my servers :</para>

      <orderedlist>
        <listitem>
          <para>webmin : great tool to amdin your server. However use it only
          if you already know how NetBSD OS is working... v1.17 -&gt;
          modification : /etc/rc.conf in System/Shutdown and Reboot
          section</para>
        </listitem>

        <listitem>
          <para>apache</para>
        </listitem>

        <listitem>
          <para>webalizer</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Install Desktop Software</title>

      <para></para>
    </section>

    <section>
      <title>Install Enhanced Software</title>

      <para></para>
    </section>
  </section>

  <section>
    <title>Customization 1 : Optimizing your Kernel</title>

    <para>Get the source, either using CVS ( cf 6 ) or using the tgz
    package...</para>

    <para></para>

    <para>Go on now ! Let's customize the kernel.</para>

    <para>The most simple if to download and to install the adjustkernel
    package and dependances from source:</para>

    <para>cd /usr/pkgsrc/sysutils/adjustkernel &amp;&amp; more DESCR</para>

    <para>make &amp;&amp; make install</para>

    <para></para>

    <para>Or, from the binary one :</para>

    <para>_________________TODO_______________</para>

    <para></para>

    <para>Change to the directory containing kernel configuration files and
    adjust the kernel you are currently using. For me it's GENERIC_LAPTOP
    :</para>

    <para>cd /usr/src/sys/arch/i386/conf</para>

    <para></para>

    <para>Now we can supprim configurations lines uneeded for your machine.
    Just type :</para>

    <para>adjustkernel -f GENERIC_LAPTOP -r -o MYKERNEL</para>

    <para></para>

    <para></para>

    <para>./sysupdate kernel</para>

    <para></para>

    <para>This will build the tool chain and your custumized kernel :
    MYKERNEL.</para>
  </section>

  <section>
    <title>Customization 2 : Keeping your OS up-to-date using CVS...</title>

    <para></para>

    <para>We are going to download sources. Beware ! You need some space to
    download them all ! Please verify you have enough disk space before
    proceding....</para>

    <para>src : around 680Mo //TO UPDATEpkgsrc : around 130Mo (without any
    "work") //TO UPDATExsrc : around Mo //TO UPDATE</para>

    <para>Since I am not aware of an easy way in NetBSD to download sources, I
    have written my own script, based on the one for OpenBSD by James
    Z.</para>

    <para>Just <ulink url="http://sysupdate/">download it</ulink>, and put it
    under /root</para>

    <para>Edit it to change the first parameter : release and cvsroot, to
    match what you are looking for.</para>

    <para>Now get the source from CVS repository :</para>

    <para>./sysupdate src</para>

    <para></para>

    <para>You can also get xsrc (usually not really needed) if you want it
    :</para>

    <para>./sysupdate xsrc</para>
  </section>

  <section>
    <title>Customization 3 : Enabling 3D Hardware Acceleration ;-)</title>

    <para>TODO...</para>
  </section>
</article>