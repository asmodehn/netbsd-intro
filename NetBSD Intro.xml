<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article PUBLIC "-//OASIS//DTD Simplified DocBook XML V1.0//EN"
"http://www.oasis-open.org/docbook/xml/simple/1.0/sdocbook.dtd">
<article>
  <title>NetBSD 3.0 Installation Quick and Clean</title>

  <subtitle>This document is aimed at gathering the best way to properly
  install NetBSD 3.0 on your machine <emphasis>(ix86)</emphasis>, as quick as
  possible, with 3 sample configurations : Server, Desktop,
  Enhanced</subtitle>

  <section>
    <title>Prerequisites</title>

    <para>For the following, I assume that you have a broadband connection, so
    you are able to download easily the needed files.</para>

    <para>I also assume that you have a basic knowledge of computers, you know
    quite well how to use OS like windows, and maybe some BSD systems. If
    something is unclear for you can refer to the <ulink
    url="http://www.netbsd.org/guide/en/">NetBSD Guide</ulink> which explains
    all the details you might need.</para>

    <para>- Server machine will run at least an HTTP serv, an FTP server, with
    SSH remote access enable.</para>

    <para>- Desktop machine will run at least XFCE4 with openoffice2
    :-)</para>

    <para>- Enhanced machine will run at least XFCE4 with 3D HW Acceleration
    to be able to play nice games :-D</para>

    <para>- All of them will be able to be kept up-to-date easily using
    CVS...</para>

    <para></para>

    <para>In the future I plan to include all the details needed so even
    "BSD-dummies" can install NetBSD.</para>

    <para>If there is any problem or you are not sure of what to do, just read
    the appropriate seciton of the <ulink
    url="http://www.netbsd.org/guide/en/">NetBSD Guide.</ulink></para>

    <para>For any comments and feedback, I would like to hear from you, so
    send me a <ulink url="mailto:asmodehn@gna.org">mail</ulink> ;-)</para>

    <para></para>
  </section>

  <section>
    <title>New Installation</title>

    <para><emphasis>This document is now focusing on installing NetBSD 3.0 (
    will be updated to match the last stable release only, although it should
    be usable for most of them )</emphasis></para>

    <section>
      <title>Using Floppies</title>

      <para>NB : The iso image is more easy to install. so if it is your first
      time, go for the iso :-)</para>

      <para>However for those who dont have a CD writer, you can get the
      floppy images from one of the servers, and create floppies. See the
      NetBSD guide for details.</para>

      <para>Boot on floppy. During the install you might need to configure the
      network to get the install sets from the network.</para>
    </section>

    <section>
      <title>Using CDROM</title>

      <para>Get the iso image from one of the server, and burn it</para>

      <para>Boot on CD.</para>
    </section>

    <section>
      <title>SysInst</title>

      <para>Sysint greatly helps you to install and preconfigure NetBSD. The
      message given are usually accurate, and people have worked a lot to make
      them as usefull as possible, so read them :-)</para>

      <para>First you have to choose the language for the install, then your
      keyboard layout.</para>

      <para>After that you have access to the main menu of Sysinst were you
      can choose what you want to do. Usually you will select "Install NetBSD"
      unless you are here for a specific purpose.</para>

      <para></para>

      <para>Now going for the installation, select "Full installation". (if
      you dont want to use X installed or some other specific requirements, go
      for the "Custom installation")</para>

      <para>The geometry detected for your disk should be fine. Then you have
      to decide if you want to use the entire disk on only one part of it (in
      the last case, you have to edit the MBR).</para>

      <para>Choose to update the MBR, unless you want to mess with
      bootloaders.</para>

      <para>Now with the NetBSD partitions, the default one is the most
      scalable, as you will not need to modify your partitions, therefore it
      is quite suitable for simple setups like Server and Desktop. But if you
      still plan to resize your partitions be aware that you should not put
      less space than the indicated default as it is the usual minimum space
      requirement. A good idea is also to balance the space between /usr and
      /home, depending of the number of user (/home bigger) and software
      installed (/usr bigger).</para>

      <para>But remember, there is no way that I am aware of to resize your
      partitions later, so, unless you really know what you are doing, you
      better keep the default setting, with only one big / partition.</para>

      <para>After that you can check your disklabel. Everything should be ok
      here. If something looks strange to you, check the NetBSD guide to
      understand what a disklabel is used for.</para>

      <para>Last chance to go cancel the install without harming your
      system...</para>

      <para>Now your disk is being initialized and all the selected sets are
      installed.</para>

      <para></para>

      <para>Now you have to set your locale time zone. If unsure, or if you
      dont want to bother about timezones (likely if you have windows on the
      same machine with automatic ntp updates), set it to
      <emphasis>Universal</emphasis>.</para>

      <para>For the passwords, if you dont have any other machine around on
      the network to deal with passwords, I would suggest to use blowfish
      algorithm, as it should be more secure...</para>

      <para>Also, defining the root password now will prevent you to forget it
      later on.</para>

      <para>And as a root shell I would personaly go for ksh, just because of
      the autocompletion by default.</para>

      <para></para>

      <section>
        <title>Server settings</title>

        <para>If you plan to have a server, and wants to modify the default
        partition setup, I would allocate more space on /var. I personaly
        advise for a /var of 2GB size at least if you dont want to bother to
        much after installation about it. Many things get written in there by
        default. (logs, mails, pkg database, temp uncompress, etc.)</para>
      </section>

      <section>
        <title>Desktop settings</title>

        <para>For a Desktop setup the default settings should be pretty fine
        :-)</para>

        <para>Although you might want to have your /home isolated from the
        rest of the system just in case of something going wrong on the
        disk...</para>
      </section>

      <section>
        <title>Enhanced settings</title>

        <para>You might want to add softdep on FFSv1 for /usr, and /home
        therefore the operation on heavy loaded file systems will be more
        efficient. You will be able to do that after the first boot just by
        editing your /etc/fstab file. However it is not safe enough to use it
        for /root and /var in my own opinion...</para>

        <para>As an example here is my setup on a 40GB disk on my laptop (1GB
        RAM) :</para>

        <para>4 GB /</para>

        <para>2 GB swap (usually around 2x the amount of RAM)</para>

        <para>10 GB /usr</para>

        <para>2 GB /var</para>

        <para>20+ GB /home</para>

        <para></para>

        <para></para>
      </section>
    </section>
  </section>

  <section>
    <title>First Boot : Basic Setup</title>

    <para><emphasis>NB from 2.0 : there is no need to change the keyboard
    layout on the first boot anymore. Sysinst has already modified the
    etc/rc.local file for you</emphasis></para>

    <para></para>

    <para>I</para>

    <para><literal></literal></para>

    <para>-------------------------- current progress
    -------------------------------------</para>

    <para></para>

    <para>If you want to change the default shell for the new added user :
    edit the /etc/usermgmt.conf</para>

    <para>vi /etc/usermgmt.conf</para>

    <para></para>

    <para>for example I'd prefer ksh instead of csh :</para>

    <para>shell/bin/ksh</para>

    <para></para>

    <para>And add a user, which can su to root, and add a password :</para>

    <para>useradd -G wheel -m &lt;username&gt;</para>

    <para>passwd &lt;username&gt;</para>

    <para></para>

    <para>Now if you don't want sendmail as your default mailer, you can edit
    the /etc/mailer.conf file, to comment sendmail lines and uncomment postfix
    ones.</para>

    <para>You can now edit /etc/fstab to add entries for cdrom and floppy.
    Simply add those lines :</para>

    <para>/dev/cd0 /mnt/cdrom cd9660 ro,noauto 0 0</para>

    <para>/dev/fd0 /mnt/floppy msdos rw,noauto 0 0</para>

    <para></para>

    <para>Then you have to create those directories :</para>

    <para>mkdir /mnt/cdrom /mnt/floppy</para>

    <para></para>

    <para>Do the same for any device you may want to mount. "man fstab" is
    your friend.</para>

    <para>Test it and go ahead for the rc.conf configuration...</para>

    <para>vi /etc/rc.conf</para>

    <para></para>

    <para>For Advanced Power Management, add :</para>

    <para>apmd=YES</para>

    <para></para>

    <para>If you are connected to a DHCP server, and want to use the network
    information it can provide :</para>

    <para>dhclient=YES dhclient_flags=”&lt;interface&gt;”</para>

    <para></para>

    <para>&lt;interface&gt; means the network interface that appear in dmesg.
    For me “ne0”.</para>

    <para>If you are not, you can provide static network information like this
    :</para>

    <para>_______________TODO________________</para>

    <para></para>

    <para>You should define a default name in /etc/myname. This will be the
    result of the 'hostname' command, and may be used in some
    applications.</para>

    <para>Now your network interface is ready, we can reboot and go on.</para>

    <para></para>

    <para>If you don't want to build your customized kernel, just edit
    rc.local to load local keymap at every boot :</para>

    <para>echo "wsconsctl -k -w encoding=fr" &gt;&gt; /etc/rc.local</para>

    <para></para>

    <para>If you don't want to customize your kernel, or if don't feel good
    with command-line based tools, you can go ahead to "Installing Usefull
    Software" and come back here later...</para>

    <para></para>

    <para>Configuring console : edit ttys after recompiling kernel...</para>

    <para>pb : console events...</para>

    <para>edit rc.conf for dhclient...</para>

    <para>nice prompt...</para>

    <para></para>

    <section>
      <title>Checking the installed system</title>

      <para></para>

      <para>First verify that your setup for your partition is fine, always a
      good idea to see what your OS needs as disk space to run :</para>

      <para><literal>&gt; df</literal></para>

      <para>Check your corresponding /etc/fstab file (add softdep setting now
      if you want to).</para>

      <para><literal>&gt; vi /etc/fstab</literal></para>

      <para>If you are not familiar with vi, check this doc.</para>

      <para></para>

      <para>Check what is running by default :</para>

      <para><literal>&gt; top</literal></para>

      <para></para>

      <para>Check which socket are open :</para>

      <para><literal>&gt; netstat</literal></para>

      <para></para>

      <para></para>
    </section>

    <section>
      <title>Fine tuning the installed system</title>

      <para>First just read your /etc/rc.conf. It gather all you system
      configuration.</para>

      <para><literal>&gt; more /etc/rc.conf</literal></para>

      <para>Pretty empty ? then all the settings come from the default file
      :</para>

      <para><literal>&gt; more /etc/defaults/rc.conf</literal></para>

      <para>Now that you know what this is about, you can turn on or off the
      part of the system you want to use. For example I dont use sendmail, so
      I can remove it from /etc/rc.conf by editing it</para>

      <para><literal>&gt; vi /etc/rc.conf</literal></para>

      <para>and adding this line</para>

      <para><literal>sendmail=NO</literal></para>

      <para></para>
    </section>
  </section>

  <section>
    <title>Second Boot : Installing Useful Software</title>

    <para>If you want to install a Server, you might need only the Common
    Console Software, and the Server Software.</para>

    <para>If you want to install a Desktop, you might need only the Common
    Console Software, Common Graphic Software and the Desktop Software.</para>

    <para>If you want to install a Development , you might need only the
    Common Console Software, Common Graphic Software, the Desktop Software and
    the Enhanced Software.</para>

    <section>
      <title>Install Common Console Software</title>

      <para></para>

      <para>There are the software i use on my compaq, for a fully fonctionnal
      console station :</para>

      <orderedlist>
        <listitem>
          <para>devel/cpuflags : install it first to optimize building from
          sources for your cpu...</para>
        </listitem>

        <listitem>
          <para>shells/standalone-tcsh : and make it the default for all users
          (much more easy than ksh)</para>
        </listitem>

        <listitem>
          <para>editors/easyedit : you can also make it the default editor of
          a user by editing ~/.cshrc and ~/.profile</para>
        </listitem>

        <listitem>
          <para>editors/vim : much more advanced than vi. If you install gvim
          for to have a gtk GUI, don't install it, as the gvim package build
          also vim for console.</para>
        </listitem>

        <listitem>
          <para>mail/fetchmail : to fetch mail from an external mail
          server</para>
        </listitem>

        <listitem>
          <para>mail/mutt : to read mail</para>
        </listitem>

        <listitem>
          <para>chat/micq : to chat on icqRun it once, it will create
          ~/.micq/micqrc file. Quit it and edit this file to add your ICQ
          password. Run it again, and after a well-done login, just type :
          "contact import"</para>
        </listitem>

        <listitem>
          <para>chat/bitchx : to chat on irc</para>
        </listitem>

        <listitem>
          <para>www/links : to surf the web ;-)</para>
        </listitem>

        <listitem>
          <para>net/lftp : an great unix ftp client</para>
        </listitem>

        <listitem>
          <para>sysutils/cdrecord : usefull if you have a CD / DVD writer
          (also contain mkisofs)</para>
        </listitem>
      </orderedlist>

      <para></para>

      <para>I actualy advise you to test them all in console, and take time to
      be used to work with your console, as it is always here, even if you
      don't have access directly to your computer, SSH POWER !!!</para>

      <para>This is really useful...</para>

      <para></para>

      <para>For specific use, you can also install :</para>

      <orderedlist>
        <listitem>
          <para>audio/lame : to encode audioYou need to accept the license and
          edit mk.conf, as it is said :</para>
        </listitem>
      </orderedlist>

      <para>ACCEPTABLE_LICENSES+=fee-based-commercial-license</para>

      <orderedlist>
        <para></para>

        <listitem>
          <para>audio/cdparanoia : to recover bad audio CDs on wav</para>
        </listitem>

        <listitem>
          <para>graphics/povray : to generate images by eralistic rendering
          from a .pov file, all in one command line ;-)You need to accept the
          license and edit mk.conf, as it is said :</para>
        </listitem>
      </orderedlist>

      <para>ACCEPTABLE_LICENSES+=povray-license</para>

      <para></para>

      <para></para>

      <orderedlist>
        <listitem>
          <para>graphics/ImageMagick : to edit and convert images in command
          line.</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Install Common Graphic Software</title>

      <para></para>

      <para>There are the software I use for a fully fonctionnal X station
      :</para>

      <orderedlist>
        <listitem>
          <para>mail/fetchmailconf (GUI for fetchmail)</para>
        </listitem>

        <listitem>
          <para>graphics/gimp</para>
        </listitem>

        <listitem>
          <para>graphics/blender (only if you can activate dri in X, otherwise
          it is really useless)</para>
        </listitem>

        <listitem>
          <para>devel/SDL</para>
        </listitem>

        <listitem>
          <para>editors/nedit</para>
        </listitem>

        <listitem>
          <para>devel/anjuta</para>
        </listitem>

        <listitem>
          <para>multimedia/mplayer</para>
        </listitem>

        <listitem>
          <para>www/mozilla</para>
        </listitem>

        <listitem>
          <para>aterm</para>
        </listitem>

        <listitem>
          <para>games/xpuyopuyo, games/xmahjong, games/frozen-bubble,
          games/freeciv-client (there is pubserver.freeciv.org where you can
          play without using your own server ;-). Nice isn't it ?)</para>
        </listitem>

        <listitem>
          <para>wm/fluxbox</para>
        </listitem>

        <listitem>
          <para>wm/xfce4-wm et wm/xfce4-wm-themes</para>
        </listitem>

        <listitem>
          <para>misc/openoffice. Beware ! You need huge disk space to build it
          from source. If you want to build it on external disk, just type
          "env WRKOBJSRC=/extern_mount/pkgsrc make update"</para>
        </listitem>
      </orderedlist>

      <para></para>

      <para></para>

      <para></para>

      <para></para>

      <para>Now we are going to setup graphical X environment to test them all
      ;)</para>

      <para></para>

      <para>Last Part : SETUP X</para>

      <para></para>

      <para>Just su as root and type :</para>

      <para>xf86cfg</para>

      <para></para>

      <para>This will try an automatized configuration of X on your computer,
      and let you customise it.</para>

      <para>After that point I personnaly prefer editing /etc/X11/XF86Config
      File with vim...</para>

      <para>Here is my file for my Keynux - Epure.</para>

      <para>After that I just create .xinitrc and .xsession file from
      /usr/X11R6/lib/X11/xinit/xinitrc.</para>

      <para>Refer to X documentation for advanced questions.</para>
    </section>

    <section>
      <title>Install Server Software</title>

      <para></para>

      <para>There are the software I am using on most of my servers :</para>

      <orderedlist>
        <listitem>
          <para>webmin : great tool to amdin your server. However use it only
          if you already know how NetBSD OS is working... v1.17 -&gt;
          modification : /etc/rc.conf in System/Shutdown and Reboot
          section</para>
        </listitem>

        <listitem>
          <para>apache</para>
        </listitem>

        <listitem>
          <para>webalizer</para>
        </listitem>
      </orderedlist>
    </section>

    <section>
      <title>Install Desktop Software</title>

      <para></para>
    </section>

    <section>
      <title>Install Enhanced Software</title>

      <para></para>
    </section>
  </section>

  <section>
    <title>Customization 1 : Optimizing your Kernel</title>

    <para>Get the source, either using CVS ( cf 6 ) or using the tgz
    package...</para>

    <para></para>

    <para>Go on now ! Let's customize the kernel.</para>

    <para>The most simple if to download and to install the adjustkernel
    package and dependances from source:</para>

    <para>cd /usr/pkgsrc/sysutils/adjustkernel &amp;&amp; more DESCR</para>

    <para>make &amp;&amp; make install</para>

    <para></para>

    <para>Or, from the binary one :</para>

    <para>_________________TODO_______________</para>

    <para></para>

    <para>Change to the directory containing kernel configuration files and
    adjust the kernel you are currently using. For me it's GENERIC_LAPTOP
    :</para>

    <para>cd /usr/src/sys/arch/i386/conf</para>

    <para></para>

    <para>Now we can supprim configurations lines uneeded for your machine.
    Just type :</para>

    <para>adjustkernel -f GENERIC_LAPTOP -r -o MYKERNEL</para>

    <para></para>

    <para></para>

    <para>./sysupdate kernel</para>

    <para></para>

    <para>This will build the tool chain and your custumized kernel :
    MYKERNEL.</para>
  </section>

  <section>
    <title>Customization 2 : Keeping your OS up-to-date using CVS...</title>

    <para></para>

    <para>We are going to download sources. Beware ! You need some space to
    download them all ! Please verify you have enough disk space before
    proceding....</para>

    <para>src : around 680Mo //TO UPDATEpkgsrc : around 130Mo (without any
    "work") //TO UPDATExsrc : around Mo //TO UPDATE</para>

    <para>Since I am not aware of an easy way in NetBSD to download sources, I
    have written my own script, based on the one for OpenBSD by James
    Z.</para>

    <para>Just <ulink url="http://sysupdate/">download it</ulink>, and put it
    under /root</para>

    <para>Edit it to change the first parameter : release and cvsroot, to
    match what you are looking for.</para>

    <para>Now get the source from CVS repository :</para>

    <para>./sysupdate src</para>

    <para></para>

    <para>You can also get pkgsrc (useful) and xsrc (usually uneeded) if you
    want it.</para>

    <para>./sysupdate pkgsrc</para>

    <para>./sysupdate xsrc</para>
  </section>

  <section>
    <title>Customization 3 : Enabling 3D Hardware Acceleration ;-)</title>

    <para>TODO...</para>
  </section>
</article>