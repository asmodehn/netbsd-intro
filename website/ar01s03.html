<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>3.&nbsp;First Boot : Setup the OS</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.69.1"><link rel="start" href="index.html" title="NetBSD 3.0 Installation Quick and Clean"><link rel="up" href="index.html" title="NetBSD 3.0 Installation Quick and Clean"><link rel="prev" href="ar01s02.html" title="2.&nbsp;New Installation"><link rel="next" href="ar01s04.html" title="4.&nbsp;Second Boot : Installing Useful Software"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">3.&nbsp;First Boot : Setup the OS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s02.html">Prev</a>&nbsp;</td><th width="60%" align="center">&nbsp;</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ar01s04.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e154"></a>3.&nbsp;First Boot : Setup the OS</h2></div></div></div><p><span class="emphasis"><em>NB from 2.0 : there is no need to change the keyboard layout on the first boot anymore. Sysinst has already modified the /etc/wscons.conf file for you.</em></span></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e160"></a>3.1.&nbsp;Checking the installed OS</h3></div></div></div><p>First verify that your setup for your partition is fine, always a good idea to see what your OS needs as disk space to run :</p><pre class="programlisting">&gt; df</pre><p>Check your corresponding /etc/fstab file (add softdep setting now if you want to).</p><pre class="programlisting">&gt; vi /etc/fstab</pre><p>Check what is running by default :</p><pre class="programlisting">&gt; top</pre><p>Check which internet socket are open :</p><pre class="programlisting">&gt; netstat -f inet</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e179"></a>3.2.&nbsp;Basic setup of the installed OS</h3></div></div></div><p>First just read your <code class="literal">/etc/rc.conf</code>. It gather all your system custom configuration.</p><pre class="programlisting">&gt; more /etc/rc.conf</pre><p>Pretty empty heh ? then all the settings come from the default file :</p><pre class="programlisting">&gt; more /etc/defaults/rc.conf</pre><p>Now you know how to turn on or off the base components of your OS. For example if you have a GENERIC_LAPTOP kernel running, you can turn on the Advanced Power Management Deamon :</p><pre class="programlisting">apmd=YES</pre><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e197"></a>3.2.1.&nbsp;File Systems Setup</h4></div></div></div><p>You may also have some devices to read floppy, cd , dvd, etc.</p><p>Let say that you have one floppy drive and one cdrom reader for example.</p><p>To be able to use them now edit <code class="literal">/etc/fstab</code> to add entries for cdrom and floppy. Simply add those lines :</p><pre class="programlisting">/dev/cd0 /mnt/cdrom cd9660 ro,noauto 0 0
/dev/fd0 /mnt/floppy msdos rw,noauto 0 0</pre><p>Then you have to create those directories :</p><pre class="programlisting">&gt; mkdir /mnt/cdrom /mnt/floppy</pre><p>Do the same for any device you may want to mount. "man fstab" is your friend :-). And remember putting all your mounted devices in /mnt will prevent a mess in your root directory (especially true if you have multiple HDD)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e217"></a>3.2.2.&nbsp;Network Setup</h4></div></div></div><p>Now you need to setup a hostname for your computer.</p><p>The easiest way to do that is by creating the file /etc/myname, and put the hostname in.</p><pre class="programlisting">&gt; echo "MyHostname" &gt; /etc/myname</pre><p>You might also need to add the hostname to your /etc/hosts file</p><pre class="programlisting">&gt; vi /etc/hosts</pre><pre class="programlisting">::1 MyHostName localhost localhost.
127.0.0.1 MyHostName localhost localhost.</pre><p>Then you need to setup your network card (also called "interface"). Once again edit your rc.conf :</p><pre class="programlisting">&gt; vi /etc/rc.conf</pre><p>If you are connected to a DHCP server, and want to use the network information it can provide :</p><pre class="programlisting">dhclient=YES dhclient_flags=&#8221;&lt;interface&gt;&#8221;</pre><p>&lt;interface&gt; means the network interface that appear in dmesg. For me &#8220;ne0&#8221;.</p><p>Otherwise you can provide static network information by creating a specific file for ifconfig:</p><pre class="programlisting">&gt; vi /etc/ifconfig.&lt;interface&gt;</pre><p>and inside put the parameter you would put like using ifconfig on the command line :</p><pre class="programlisting">inet 192.168.0.42 netmask 0xffffff00</pre><p>You can test your network configuration anytime by calling :</p><pre class="programlisting">&gt; ifconfig -a</pre><p>Once you have activated the interface, you can go to another machine connected to the network and try to ping your new NetBSD computer.</p><p>Now to access internet from your new NetBSD computer you need to define the gateway. For example :</p><pre class="programlisting">&gt; echo "192.168.1.1" &gt; /etc/mygate</pre><p>Then you have to define the dns server to resolv internet names. Edit /etc/resolv.conf :</p><pre class="programlisting">&gt; vi /etc/resolv.conf</pre><p>and add the DNS server(s) you want to use to resolve internet names.</p><pre class="programlisting">name server 192.168.1.1</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e268"></a>3.2.3.&nbsp;Mail Setup</h4></div></div></div><p>Now that you know what this is about, you can turn on or off the part of the system you want to use. For example I dont use sendmail, so I can remove it from /etc/rc.conf by editing it</p><pre class="programlisting">&gt; vi /etc/rc.conf</pre><p>and adding this line</p><pre class="programlisting">sendmail=NO</pre><p>but I might use postfix from time to time just for smtp, and also to get all the maintenance messages sent to root... So go to your <code class="literal">/etc/mailer.conf</code>, comment the sendmail lines, and uncomment the postfix lines. now back to your <code class="literal">/etc/rc.conf</code>, and add :</p><pre class="programlisting">postfix=YES</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e289"></a>3.2.4.&nbsp;Power User Setup</h4></div></div></div><p>Now I advise you to create a new user, for you and your every-day work. Using the system always with a root account is a bad idea, as one little mistake can destroy everything...</p><p>So first enable ksh by default for all the new created users</p><pre class="programlisting">&gt; vi /etc/usermgmt.conf</pre><p>change the related line to be :</p><pre class="programlisting">shell /bin/ksh</pre><p>Now you can add a new user with his own group, who will be able to su to root and define his password:</p><pre class="programlisting">&gt; useradd -G wheel -g &lt;username&gt; -m &lt;username&gt;
&gt; passwd &lt;username&gt;</pre><p>Then exit and login again as the new user. If everything works fine, you can call "su" to authenticate as root again to continue to setup your OS.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e308"></a>3.2.5.&nbsp;Power User -&gt; Setup SSH client</h4></div></div></div><p>On many applications and systems nowadays, you need to be identify by an SSL Key.</p><p>Let's start by creating one RSA key :</p><pre class="programlisting">&gt; ssh-keygen -t rsa</pre><p>I would advise to setup a passphrase and store the key in the default location ( .ssh subdirectory ). Later on we will setup the user session to run the ssh-agent automatically at startup.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e319"></a>3.3.&nbsp;Advanced setup of the installed OS</h3></div></div></div><p>Now lets get a bit more fancy :-)</p><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e324"></a>3.3.1.&nbsp;Root -&gt; Improved wscons</h4></div></div></div><p>I like having 4 virtual terminal, but it might be usefull to be able to use the max amount, that is 8 of them.</p><p><span class="bold"><strong>WARNING : If you plan to run X, you should NOT RUN GETTY on the same terminal. I usually keep the last one for X.</strong></span></p><p>First you have to edit /etc/wscons.conf :</p><p><code class="literal">&gt; vi /etc/wscons.conf</code></p><p>and add the corresponding line at the right place :</p><pre class="programlisting">screen 1 - -
screen 2 - -
screen 3 - -
screen 4 - -
screen 5 - -
screen 6 - -
screen 7 - -</pre><p>then to be able to log in those terminals, you have to edit <code class="literal">/etc/ttys</code> :</p><pre class="programlisting">&gt; vi /etc/ttys</pre><p>Usually I change console to <code class="literal">off</code>, and I keep ttyE0 to <code class="literal">off</code> not to mix console output and shell, then I add the needed lines :</p><pre class="programlisting">console "/usr/libexec/getty Pc" vt100 off secure
ttyE0 "/usr/libexec/getty Pc" vt220 off secure
ttyE1 "/usr/libexec/getty Pc" vt220 on secure
ttyE2 "/usr/libexec/getty Pc" vt220 on secure
ttyE3 "/usr/libexec/getty Pc" vt220 on secure
ttyE4 "/usr/libexec/getty Pc" vt220 on secure
ttyE5 "/usr/libexec/getty Pc" vt220 on secure
ttyE6 "/usr/libexec/getty Pc" vt220 on secure
ttyE7 "/usr/libexec/getty Pc" vt220 off secure</pre><p>reboot and give it a try :-)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e360"></a>3.3.2.&nbsp;Root -&gt; Setup X</h4></div></div></div><p>Do you want to setup X ? just run :</p><pre class="programlisting">&gt; xf86cfg</pre><p>It should detect your hardware, and setup a default configuration for you. After that you can customize your X setup.</p><p>Then exit and save the configuration. Now test it :</p><pre class="programlisting">&gt; startx</pre><p>The server X will run with all the default settings. If you want to customize the setup, copy xinitrc to your local folder :</p><pre class="programlisting">&gt; cp /etc/X11/xinit/xinitrc ~/.xinitrc</pre><p>If everything runs fine, you can now setup XDM. First be sure of the terminal you want to run X on (careful ttys start at 0 but vt starts at 1) :</p><pre class="programlisting">&gt; vi /etc/X11/xdm/Xservers</pre><pre class="programlisting">:0 local /usr/X11R6/bin/X vt08 -nolisten tcp</pre><p>Now for the <span class="bold"><strong>Desktop configuration</strong></span>, you need to turn it on in your <code class="literal">/etc/rc.conf</code> :</p><pre class="programlisting">&gt; vi /etc/rc.conf</pre><pre class="programlisting">xdm=YES</pre><p>Now on your next start up xdm will be running on the 8th virtual terminal.</p><p>For the <span class="bold"><strong>Server Configuration</strong></span>, you can still run X when you need it by using the '<code class="literal">startx</code>' command.</p><p>We will go a bit further later on when we will have our desktop manager :-).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e407"></a>3.3.3.&nbsp;Root -&gt; Get Sysupdate and Pkgsrc</h4></div></div></div><p>And now what if you want to be able to install software ? or customise your installation even more ? Then try this usefull script : <a href="http://download.gna.org/netbsd-intro/sysupdate" target="_top">sysupdate</a>.</p><p>To retrieve it from your machine, maybe the simplest way is just to use telnet :</p><pre class="programlisting">&gt; telnet download.gna.org 80 &gt; sysupdate
GET http://download.gna.org/netbsd-intro/sysupdate</pre><p>And remove the HTTP headers...</p><p>Using this script you can quite easily download and update via CVS the source for the OS (/usr/src) for the X server (/usr/xsrc) or the pkgsrc tree (/usr/pkgsrc)</p><p>Just look at the first lines, you will see where you can easily customize the variables to match your needs.</p><p>For the next step, just checkout pkgsrc like that :</p><pre class="programlisting">&gt; ./sysupdate pkgsrc</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e429"></a>3.3.4.&nbsp;Installing really usefull packages</h4></div></div></div><p>Here are the packages you would like to have in any case :</p><div class="orderedlist"><ol type="1"><li><p>pkgtools/pkg_install : install it first to have the latest verison of the packages install tools</p></li><li><p>devel/cpuflags : install it first to optimize building from sources for your cpu...</p></li><li><p>shells/standalone-tcsh : install it if you want to get rid of ksh :). You can make it the default for all users if you want to.</p></li><li><p>security/auditpackages : install it to know if the package you are trying to install has a security flaw in it.</p></li><li><p>pkgtools/pkgfind : really usefull to find the package you need.</p></li><li><p>pkgtools/pkg_chk : really usefull to know which ones of your packages needs to be updated</p></li><li><p>net/wget : really usefull to grab files from the web</p></li><li><p>www/links : text based web browser, cause you always need to browse the web to get informations.</p></li></ol></div><p>To install a package is pretty easy. For example for pkg_install :</p><pre class="programlisting">&gt; cd /usr/pkgsrc/pkgtools/pkg_install
&gt; make install</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e463"></a>3.3.5.&nbsp;Root -&gt; Improved X</h4></div></div></div><p>For the root user I like to have a better window manager than twm. Let's install fluxbox :</p><pre class="programlisting">&gt; cd /usr/pkgsrc/wm/fluxbox
&gt; make update</pre><p>I used make update here in case of fluxbox needed a sub-dependency to be updated, it will not stop the process and will just do it.</p><p>Now you can modify <code class="literal">~/.xinitrc</code> :</p><pre class="programlisting">&gt; vi ~/.xinitrc</pre><p>Remove any other window manager ( like twm ). Just make sure that the last line actually runs fluxbox. Of course you can still run some other usefull apps before that. For example :</p><pre class="programlisting">xclock -geometry 50x50-1+1 &amp;
xterm -geometry 80x50+494+51 &amp;
xterm -geometry 80x20+494-0 &amp;
xterm -geometry 80x66+0+0 &amp;
exec fluxbox</pre><p>This way the server will exit when you exit the window manager.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e485"></a>3.3.6.&nbsp;Power User -&gt; Improved X</h4></div></div></div><p>For the power user the idea is to get the ssh-agent setup on the startup of his session. Then we will use XFCE4 along with xdm.</p><p>First we need to create the ~/.xsession file to startup the agent. Mine looks like that :</p><pre class="programlisting">#!/bin/sh
if [ -d $HOME/.ssh ]
then EXEC="exec ssh-agent"
else EXEC="exec"
fi
if [ -x $HOME/.xinitrc ]
then $EXEC $HOME/.xinitrc
else $EXEC xterm -geometry 80x24+0-60 -ls
fi</pre><p>If you have a key in the default <code class="literal">.ssh</code> directory, it will start the agent along with your <code class="literal">.xinitrc</code>.</p><p>Now we need to run ssh-add to add the key to the agent, and ask for the password. Edit your .xinitrc :</p><pre class="programlisting">&gt; vi .xinitrc</pre><p>after the Xresources setup sections, it should look like that :</p><pre class="programlisting">if [ X$SSH_AUTH_SOCK != X ]; then
ssh-add &lt; /dev/null &amp; 
fi

exec startxfce4</pre><p>Just keep in mind that XCFE4 has a session manager which can automatically rerun apps from the last saved session.</p><p>Now on every login ssh-askpass will popup and ask you for your passphrase if needed. Your agent will be running in the background to authentify you without annoying you ;-)</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h4 class="title"><a name="d0e514"></a>3.3.7.&nbsp;Power User -&gt; Running SUN's JDK and JRE</h4></div></div></div><p>Now that we have a nicely setup X we can install java.</p><p>As you are told when you do :</p><pre class="programlisting">&gt; cd /usr/pkgsrc/lang/sun-jdk15
&gt; make update</pre><p>You will have to have the linux compatibility enabled (enabled by default in the GENERIC Kernel) and the linux procfs mounted (you already knw how to do that).</p><p>You will also need to increase the default limits for the user, and setup the rights paths.</p><p>This is how I setup my .cshrc for it (using csh or tcsh) :</p><pre class="programlisting">
#java setup
limit datasize 656020
setenv JAVA_HOME /usr/pkg/java/sun-1.5
setenv PATH ${PATH}:${JAVA_HOME}/bin
setenv CLASSPATH ${JAVA_HOME}/jre/lib/rt.jar
</pre><p>and for the .profile if you are using sh or ksh :</p><pre class="programlisting">#java setup
TODO</pre><p>Now your java installaiton should work. You can give it a try :</p><pre class="programlisting">&gt; java -version</pre></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s02.html">Prev</a>&nbsp;</td><td width="20%" align="center">&nbsp;</td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ar01s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">2.&nbsp;New Installation&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;4.&nbsp;Second Boot : Installing Useful Software</td></tr></table></div></body></html>